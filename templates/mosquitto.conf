{% if mqtt_enable_insecure== "true" %}

listener 1883

password_file /mosquitto/config/passwd
allow_anonymous {{ mqtt_anonymous }}

persistence true
persistence_location /mosquitto/data/

{% endif %}


{% if mqtt_enable_tls == "true" %}

listener 8883

cafile {{ cert_dir }}/ca.crt
keyfile {{ key_dir }}/server.key
certfile {{ cert_dir }}/server.crt

password_file /mosquitto/config/passwd
allow_anonymous {{ mqtt_anonymous }}

persistence true
persistence_location /mosquitto/data/

tls_version tlsv1.2

{% endif %}